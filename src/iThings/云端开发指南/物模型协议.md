# 物模型协议
## 简介
物模型可将物理世界中的设备功能进行数字化定义，便于应用更便利的管理设备。平台为用户提供了基于物模型的业务协议，既可以满足智慧生活场景应用，也可满足物联网各垂直行业应用需求。
* 智慧生活场景：基于物模型协议，用户将设备相关属性、事件等上报云端后，可无缝使用腾讯连连小程序或自主品牌小程序与 App，无需处理云端与小程序或 App 的通信细节，以提升用户在智慧生活场景下的应用开发效率。
* 垂直行业应用场景：基于物模型协议，无需用户解析设备数据，可使用物联网开发平台的数据分析、告警和存储服务及腾讯云相关云产品，以提升垂直行业应用的开发效率。
## 物模型协议
### 概述
产品定义物模型后，设备可以根据物模型中的定义上报属性、事件，并可对设备下发控制指令。物模型的管理详见 产品定义。物模型协议包括了以下几部分。  
* 设备属性上报：设备端将定义的属性根据设备端的业务逻辑向云端上报。
* 设备远程控制：从云端向设备端下发控制指令，即从云端设置设备的可写属性。
* 获取设备最新上报信息：获取设备最新的上报数据。
* 设备事件上报：设备可根据定义的物模型中的事件，当事件被触发，则根据设备事件上报的协议上报告警、故障等事件信息。
* 设备行为调用：云端可以通过 RPC 的方式通知设备执行某个动作行为，适用于应用需要实时获取设备的执行结果的场景。
* 设备初始信息上报：设备连接平台时上报的初始信息，便于小程序或 App 展示设备详细信息，如设备 MAC 地址、IMEI 号。
### 设备属性上报
1. 当设备需要向云端上报设备运行状态的变化时，以通知应用端小程序、App 实时展示或云端业务系统接收设备上报属性数据，物联网开发平台为设备设定了默认的 Topic：
   * 设备属性上行请求 Topic： $thing/up/property/{ProductID}/{DeviceName}
   * 设备属性上行响应 Topic： $thing/down/property/{ProductID}/{DeviceName}
2. 请求
   * 设备端请求报文示例：
```json
{
  "method":"report",
  "clientToken":"123",
  "timestamp":1628646783,
  "params":{
    "power_switch":1,
    "color":1,
    "brightness":32
  }
}
```   
   * 请求参数说明：  

| 参数                   | 类型        | 说明                                                  |
|:---------------------|:----------|:----------------------------------------------------|
| method	              | String	   | report 表示设备属性上报                                     |
| clientToken	         | String    | 	用于上下行消息配对标识                                        |
| timestamp	           | Integer   | 	属性上报的时间，格式为 UNIX 系统时间戳，不填写该字段表示默认为当前系统时间。单位为毫秒     |
| params	              | JSON	JSON | 结构内为设备上报的属性值                                        |
| params.power_switch	 | Boolean   | 	布尔型属性的值一般为0或1                                      |
| params.color	        | Enum	     | 枚举整型属性的值为整数值，数值类型填写错误或超过枚举项定义范围出现406返回码，表示物模型格式校验错误 |
| params.brightness	   | Integer   | 	整数型属性的值为整数值，数值类型填写错误或超过数值范围会出现406返回码，表示物模型格式校验错误   |

3. 响应
  * 云端返回设备端报文示例：
```json
{
  "method":"report_reply",
  "clientToken":"123",
  "code":0,
  "status":"some message where error"
}
```
* 响应参数说明：

  | 参数 | 类型  | 说明 |
  |:------------|:----------|:--------------|
  | method	      | String	 | report_reply 表示云端接收设备上报后的响应报文  |
  | clientToken	 | String      | 	用于上下行消息配对标识                   |
  | code         | 	Integer    | 	0表示云端成功收到设备上报的属性              |
  | status       | 	String     | 	当 code 非0的时候，提示错误信息           |

### 设备远程控制

## 错误码