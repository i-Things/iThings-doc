# 产品开发
## 产品定义
### 操作场景
  通过物联网开发平台将设备对接到iThings时。需要创建项目，并在项目下创建产品、定义产品的数据模板。本文档主要介绍如何使用开发平台创建项目并进行产品定义。
### 操作步骤
#### 创建产品
产品相当于某一类设备的集合，用户通过产品管理其下的所有设备。  
1. 单击创建的项目进入产品开发中心，单击新建产品，定义您的产品。
2. 根据页面提示填写产品基本信息，然后单击保存。
    <img src="/assets/thingsMethod/developCenter/productDevelop/创建产品.png">
   产品基本信息设置如下：
   * 产品名称：名称为中文、字母、数字、下划线的组合，1 - 20位且不能为空。
   * 产品品类：选择您所创建产品的所属品类，不同类型产品的属性、事件等数据模板会有所不同。详情请参见 数据模板。
   * 设备类型：设备类型分为设备、网关、子设备3类，详情如下：
     * 设备：此类设备可直接接入物联网开发平台且无挂载子设备。
     * 网关：此类设备可直接接入物联网开发平台，并且可接受子设备加入局域网络。可以维持子设备的拓扑关系，将与子设备的拓扑关系同步到云端。
     * 子设备：此类设备必须依托网关设备才可与物联网开发平台进行通信，例如 Zigbee、蓝牙、RF433 等设备。网关与子设备的说明，请参考文档 网关子设备
   * 认证方式：物联网开发平台提供两种认证方式用于设备与平台之间鉴权认证。
     * 证书认证：在创建设备时，平台将为设备生成一个证书文件和一个私钥文件，实现设备与云之间的双向认证。
     * 密钥认证：在创建设备时，使用平台为设备随机生成的 PSK。
   * 通信方式：您可以选择 Wi-Fi、移动蜂窝（2G/3G/4G）、5G、BLE、LoRaWAN和其他通信方式。
   * 接入网关协议（设备类型选择为子设备可选）：表示该产品下的设备作为子设备与网关的通讯协议类型。
     * Zigbee：表示子设备和网关间的通讯协议为ZigBee。
     * BLE：表示子设备和网关间的通讯协议为BLE。
     * 433：表示子设备和网关间的通讯协议为433。
     * 自定义：表示子设备和网关间的通讯协议为其它标准或私有协议。
   * 数据协议：默认采用物模型的数据协议，您也可以自定义协议进行透传。
   * 描述：字数不能超过80个，您可以根据需要选填。
#### 删除产品
`为了防止误操作删除产品影响您的业务，若该产品下还有设备，则不允许删除该产品。`

## 物模型
### 简介
数据模板通过将物理实体设备进行数字化描述，构建其数字模型。在物联网开发平台定义数据模板即定义产品功能。  
完成功能定义后，系统将自动生成该产品的数据模板。  
单击已创建的产品，进入产品开发环节，产品开发第一步即定义数据模板。  

<img src="/assets/thingsMethod/developCenter/productDevelop/新增物模型.png">

### 功能类型
产品的功能包括标准功能和自定义功能。  

| 功能类型  | 	功能描述                     |
|:------|:--------------------------|
| 标准功能  | 	该产品类别下提供的常用功能，默认已创建。     |
| 自定义功能 | 	如果标准功能无法满足您的需求，您可以自定义功能。 |

**标准功能**：部分分为必选属性和可选属性，必选属性不可删除，部分属性可编辑；可选属性则可删除、可编辑。  
**自定义功能**：则可由开发者自由删除和编辑。这里需要注意的是，已发布的产品不能编辑与删除属性与事件。  

功能类型包含三元素：属性、事件和行为。其中属性包括布尔型、整数型、字符型、浮点型、枚举型和时间型等6种基本数据类型。
事件包括告警、故障和信息三种类型，事件型功能属性可以添加具体的事件参数，这些参数可以由属性中6种基本数据类型组成。
行为则是用于实现更复杂的业务逻辑，可包含输入参数和输出参数，可用于让设备执行某项特定的任务。
行为的输入参数和输出参数可添加上述6种属性的基本数据类型。  

| 功能元素 | 	功能描述	                                                                       | 功能标识符        |
|:-----|:-----------------------------------------------------------------------------|:-------------|
| 属性   | 	用于描述设备的实时状态，支持读取和设置，如模式、亮度、开关等。	                                            | PropertiesId |
| 事件   | 	用于描述设备运行时的事件，包括告警、信息和故障等三种事件类型，可添加多个输出参数，如环境传感器检测到空气质量很差，空调异常告警等。	          | EventId      |
| 行为   | 	用于描述复杂的业务逻辑,可添加多个调用参数和返回参数,用于让设备执行某项特定的任务，例如，开锁动作需要知道是哪个用户在什么时间开锁，锁的状态如何等。	 | ActionId     |

* 布尔型：非真即假的二值型变量。例如，开关功能。
* 整数型：可用于线性调节的整数变量。例如，空调的温度。
* 字符型：以字符串形式表达的功能点，例如，灯的位置。
* 浮点型：精度为浮点型的功能点。例如，压力值的范围：0.0 - 24.0。
* 枚举型：自定义的有限集合值。例如，灯的颜色：白色、红色、黄色等。
* 时间型：string 类型的 UTC 时间戳（毫秒）。

### 功能示例
属性、事件功能在用户创建的产品已包含一定标准功能，若用户需要根据业务场景新增，也可在自定义功能栏中新增。本文提供了部分功能示例：
进入控制台自定义功能新建功能页面，进入对应设置界面：  
**属性示例**：  

<img src="/assets/thingsMethod/developCenter/productDevelop/属性物模型编辑.png">

**事件示例**：  

<img src="/assets/thingsMethod/developCenter/productDevelop/事件物模型编辑.png">

**行为示例**：  

<img src="/assets/thingsMethod/developCenter/productDevelop/行为物模型编辑.png">

### 数据模板格式参考
以下为宠物定位项圈的数据模板字段描述说明，包括各种数据类型和事件类型。示例代码如下：  
```json
{
  "version":"1.0",
  "properties":[
    {
      "identifier":"battery_state",
      "name":"电池情况",
      "desc":"",
      "mode":"r",
      "define":{
        "type":"int",
        "min":"0",
        "max":"100",
        "start":"0",
        "step":"1",
        "unit":""
      },
      "required":false
    },
    {
      "identifier":"positioning_mode",
      "name":"定位模式",
      "desc":"",
      "mode":"rw",
      "define":{
        "type":"enum",
        "mapping":{
          "0":"省电模式",
          "1":"普通模式",
          "2":"性能模式"
        }
      },
      "required":false
    },
    {
      "identifier":"lac",
      "name":"地区区域码",
      "desc":"地区区域码",
      "required":true,
      "mode":"r",
      "define":{
        "type":"int",
        "unit":"",
        "step":"1",
        "min":"0",
        "max":"32",
        "start":"0"
      }
    },
    {
      "identifier":"cid",
      "name":"基站码",
      "desc":"基站码",
      "required":true,
      "mode":"r",
      "define":{
        "type":"int",
        "unit":"",
        "step":"1",
        "min":"0",
        "max":"32",
        "start":"0"
      }
    },
    {
      "identifier":"rssi",
      "name":"信号强度",
      "desc":"",
      "mode":"r",
      "define":{
        "type":"string",
        "min":"0",
        "max":"8"
      },
      "required":false
    },
    {
      "identifier":"GPS_Info",
      "name":"GPS定位",
      "desc":"",
      "mode":"rw",
      "define":{
        "type":"struct",
        "specs":[
          {
            "identifier":"longtitude",
            "name":"GPS经度",
            "dataType":{
              "type":"float",
              "min":"-180",
              "max":"180",
              "start":"0",
              "step":"0.001",
              "unit":"度"
            }
          },
          {
            "identifier":"latitude",
            "name":"GPS纬度",
            "dataType":{
              "type":"float",
              "min":"-90",
              "max":"90",
              "start":"0",
              "step":"0.001",
              "unit":"度"
            }
          }
        ]
      },
      "required":false
    }
  ],
  "events":[

  ],
  "actions":[
    {
      "identifier":"whistle",
      "name":"鸣笛控制",
      "desc":"控制宠物定位项圈上的蜂鸣器鸣笛固定时长,switch为0时关闭鸣笛",
      "input":[
        {
          "identifier":"time",
          "name":"鸣笛时长_秒",
          "define":{
            "type":"int",
            "min":"0",
            "max":"600",
            "start":"0",
            "step":"1",
            "unit":""
          }
        },
        {
          "identifier":"switch",
          "name":"是否鸣笛",
          "define":{
            "type":"bool",
            "mapping":{
              "0":"关",
              "1":"开"
            }
          }
        }
      ],
      "output":[
        {
          "identifier":"code",
          "name":"控制结果",
          "define":{
            "type":"enum",
            "mapping":{
              "0":"成功",
              "1":"失败",
              "2":"硬件错误"
            }
          }
        }
      ],
      "required":false
    }
  ]
}
```

## 设备调试
### 操作场景
设备开发完成后，需要进入设备调试阶段调试设备与云端的通信是否正常。
设备调试提供了真实设备在线调试及虚拟设备调试，并可通过控制台查询设备上报的当前数据、历史通信日志、事件及上下线记录等。
本文档主要介绍如何进行设备调试。

### 操作步骤
#### 新建设备
1. 设备开发完成后，单击设备列表，进入设备调试环节。
2. 选择新建设备，如下图输入设备名，单击保存，即可创建设备。
3. 创建成功后，将会在“设备列表”列表页中查看到新建成功的设备。
<img src="/assets/thingsMethod/developCenter/productDevelop/新建设备.png">

#### 查看设备消息
1. 新建设备成功后，需要查询设备信息，获取重要参数及进行设备调试。
2. 单击设备列表的设备名称，即可查看设备的信息及设备上报云端的状态、上下行日志等信息。
3. 设备查看打开后，即可查看设备的所有信息。
   * 设备密钥：使用密钥认证需要将此信息烧录到设备端。
   * 产品 ID：唯一标识，需要烧录到设备端。
   * 激活时间：设备第一次连接开发平台的时间。
   * 最后上线时间：设备最后一次连接开发平台的时间。
   * 设备状态：如果设备在线，则显示“在线”，如果设备离线，则显示“离线”，如果设备从未连接开发平台，则显示“未激活”。

<img src="/assets/thingsMethod/developCenter/productDevelop/设备信息详情.png">


#### 设备属性
1. 查看设备信息：单击查看设备信息。
2. 列表中将该设备的数据模板的功能项列出。
   * 变量标识符：对应该设备的数据模板中的标识符。
   * 变量名称：对应数据模板中的“功能名称”。
   * 历史数据：单击查看，即可查询该功能项的历史上报数据。
   * 变量类型：对应数据模板中的“数据类型”。
   * 最新值：当设备在向云端上报数据时，只要某个功能的最新上报值发生变化，最新值列都会立刻显示设备上报的最新值。
   * 更新时间：指最新值的变化时间。一般是设备上报该功能的发生时间。
3. 查看某个功能的历史上报数据。按时间展示该功能上报到云端的历史数据，验证上报的数据是否正确。

<img src="/assets/thingsMethod/developCenter/productDevelop/物模型数据.png">


#### 设备日志
单击设备日志，即可查看该设备上行到云端，并从云端接收的信息。
* 上行：上行表示设备端向云端上报的数据。
* 下行：下行表示云端向设备端发送的数据。

<img src="/assets/thingsMethod/developCenter/productDevelop/设备云端日志.png">

#### 设备事件
单击设备事件，即可查看该设备上报到云端的事件信息。
* 事件的定义：在数据模板中定义管理。
* 事件类型：系统将事件类型分为三种，分别是告警、故障、信息。

#### 设备行为
单击设备行为，即可查看该设备的行为信息。
* 行为的定义：在数据模板中定义管理。
* 行为描述：用于描述复杂的业务逻辑，可添加多个调用参数和返回参数，可用于让设备执行某项特定的任务，例如，开锁动作需要知道是哪个用户在什么时间开锁，锁的状态如何等。

#### 设备上下线日志
单击设备上下线日志，即可查看该设备连接云端与断开连接的日志记录。
<img src="/assets/thingsMethod/developCenter/productDevelop/设备云端日志.png">

#### 真实设备在线调试 
1. 当您的真实设备已成功对接到开发平台后，则可以使用在线调试对真实设备进行数据收发的测试。
2. 单击在线调试，即可进入在线调试功能。前提是真实设备已开启并成功连接到开发平台。
3. 在线调试左侧的操控面板是根据设备所属产品的数据模板自动生成，设置需要下发的数据后，单击发送后，系统会自动触发控制指令到设备端。
4. 设备端接收到指令后，会立刻返回数据到云端并显示在右侧的文本框中。  
<img src="/assets/thingsMethod/developCenter/productDevelop/在线调试.png">
